
<dom-module id="sn-receita-bruta-filters">
  <template>
    <style>
      :host {
        display: block;
      }

    paper-input[disabled] /deep/ * {
      opacity:1!important;
   
    }

    </style>
    	
    	<sn-data-top id="dataTOP" 
            on-response-faixacontrato="_topFaixaContratoHandler"
            on-response-infocontrato="_topInfoContratoHandler">
         </sn-data-top>

         <div class="layout horizontal">
            <h5 style="width: 134px;font-size: 14px;margin-right: 4px;color: #FFF;">Receita Bruta</h5>
            
            <paper-dropdown-menu label="Cliente" id="cliente" on-iron-select="_onChangeFilter">
               <paper-listbox class="dropdown-content" selected="0" id="clienteListBox">
                  <template is="dom-repeat" items="{{clientList}}">
                     <paper-item>{{ item.nome }}</paper-item>
                  </template>
               </paper-listbox>
            </paper-dropdown-menu>

            <paper-dropdown-menu label="Faixa DWT" id="faixaDWT" on-iron-select="_onChangeFilter">
               <paper-listbox class="dropdown-content" selected="0" id="faixaDWTListBox" style="width: 92px;">
                  <paper-item>Todos</paper-item>
                  <template is="dom-repeat" items="{{faixaList}}">
                     <paper-item>{{ item }}</paper-item>
                  </template>
               </paper-listbox>
            </paper-dropdown-menu>

            <paper-dropdown-menu label="Terminal" id="terminal" on-iron-select="_onChangeFilter">
               <paper-listbox class="dropdown-content" selected="0" id="terminalList" style="width: 92px;">
                  <template is="dom-repeat" items="{{terminalList}}">
                     <paper-item style="width: 172px;">{{ item }}</paper-item>
                  </template>
               </paper-listbox>
            </paper-dropdown-menu>

            <style>
               #terminal /deep/ .dropdown-content {
               width: 219px;
               }
               #terminal /deep/ iron-dropdown {
               }
            </style>

            <paper-input 
               label="Contrato"         
               id="inputContrato" 
               value="*" 
               readonly></paper-input>
            <paper-input 
               label="Tipo de Tarifa"   
               id="inputTipoTarifa" 
               value="*" 
               readonly></paper-input>
            <paper-input 
               label="Moeda"            
               id="inputMoeda" 
               value="*" 
               readonly></paper-input>
            <paper-input label="Tarifa U$"  value="3.25"  readonly></paper-input>

         </div>
  </template>
  <script>
    Polymer({
      is: 'sn-receita-bruta-filters',
       properties:{
      
          faixaList:{
            type:Array
            
          },
          path:{type:String},
          selectedFaixas : {type:Array},
          selectedCliente: {value:"Cliente1"},
          clientList : {value:[
      
            {nome:"Saveiros" ,num_contrato:"RJ1000153"},
            {nome:"Camorim"  ,num_contrato:"RJ1000158"},
            {nome:"Wallenius",num_contrato:"RJ1000590"}
          ]},
      
      
        },
        observers:['_buildPath(selectedCliente,selectedTerminal)'],

        _buildPath:function(){
          if( this.selectedCliente && this.selectedTerminal)
            this.path = this.selectedCliente + '/' + this.selectedTerminal
            this.fire('path-changed');
        },
        _onChangeFilter:function(e,d) {

          var filterId = e.path[11].id;
          var filterValue = d.item.innerText;


          var F = {
            faixaDWT: function() {
            	
       		  _.each(document
       		  	.querySelectorAll('* /deep/ sn-receita-bruta /deep/ sn-tabela-mes')
	   		  	,function(tabelaMesElement){
	   		  		tabelaMesElement.filterByDimensionsList();
	   		  	})

            },
            cliente:function() {
              this.selectedCliente = d.item.textContent;
              var num_contrato = _(this.clientList).groupBy('nome')[this.selectedCliente][0].num_contrato;
              this.$.inputContrato.value = num_contrato;

              this.$.dataTOP.getFaixasContrato(num_contrato,this._refreshFaixas);
              this.$.dataTOP.getInfoContrato(num_contrato);
            },
            terminal:function() {
				this.selectedTerminal = d.item.textContent;
				this._refreshFaixas();
            }
          }

          F[filterId].bind(this)();

        },
        _refreshFaixas:function(){
			if(!this.selectedTerminal)
				return;
			//volta para faixa todos
			this.$.faixaDWTListBox.selected  = 0;
			//fill
			this.fire('build-faixas',{
				faixasTarifa: this.$.dataTOP._terminalFaixasTarifa[this.selectedTerminal]
			})

			var TOP = this.$.dataTOP;
			this.selectedFaixas     
				= this.faixaList 
				= TOP.getFaixasByTerminal(this.selectedTerminal || _.first(this.terminalList));

        },

        //TOPWEB responses
        _topFaixaContratoHandler:function(){
		  this.terminalList       = this.$.dataTOP.terminalList;
          this._refreshFaixas();
        },
        _topInfoContratoHandler:function(e,d) {
		  this.$.inputMoeda.value       = d.DESCRICAO_MOEDA;
          this.$.inputTipoTarifa.value  = d.CD_TIPO_CONTRATO
        }
        
    });
  </script>
</dom-module>