
<link rel="import" href="sn-tabela-mes.html">
<link rel="import" href="sn-data-top.html">
<link rel="import" href="sn-relatorios.html">

<dom-module id="sn-receita-liquida">
	<template>
		<style>
			:host {
				display: block;
         		padding: 10px;
			}
			
         paper-material {
	         background:#FFF;
	         padding:8px;
         }
		</style>
		<div id="filters">
		</div>
		<paper-material>

			<sn-relatorios 
				filial="{{_currentFilial}}" 
				id="relatorio" 
				not-ui
				on-get-data-from-base="_getDataFromBaseHandler"></sn-relatorios>

			<sn-tabela-mes 
	            id="tablePercentualFixo"
	            db="percentual-fixo" 
	            on-tabela-mes-build="_tabelaMesBuildHandler"
	            path="{{_path}}"
	            dimensions="{{ _dimensions }}"  
	            header="Deduções da Receita - Percentual Fixo"
	            meta
	            meta-header="%"></sn-tabela-mes>

	        <sn-tabela-mes 
	            id="tablePercentualManual"
	            db="percentual-manual" 
	            on-tabela-mes-build="_tabelaMesBuildHandler"
	            path="{{_path}}"
	            dimensions="{{ _dimensions }}"  
	            header="Deduções da Receita - Percentual Manual"
	            meta
	            meta-header="%"
	            meta-editable></sn-tabela-mes>
			
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'sn-receita-liquida',
			properties:{
				_path:{type:String},
				_dimensions:{type:String},
				_currentFilial:{type:String}
			},
			observers:['_buildPath(_currentFilial)'],
			ready:function(){
				this._currentFilial = "RJ1";
			},
			_buildPath:function(){
				this._path = "receita-liquida/"+this._currentFilial;
				this._dimensions = ['PIS','Cofins','ISS'];
				this.$.relatorio.render(
					{
						aggList:['Filial','Tipo de Faturamento'],
						aggregator:'receita-total',
						filterMap:{Filial:'RJ1'}
					});
			},
			//sn-tabela-mes
			_tabelaMesBuildHandler:function(){
				var ReceitaBrl = this.$.relatorio.getValuesFromTR('FATURA')
				var ReceitaExt = this.$.relatorio.getValuesFromTR('INVOICE')
				var ReceitaTtl = this.$.relatorio.getValuesFromTR('Totals')

				this.$.tablePercentualFixo
					.put(ReceitaBrl,
						{ifDimIs:['PIS','Cofins'],Tax:{PIS:0.0165,Cofins:0.076}
					});

				this.$.tablePercentualFixo
					.put(ReceitaTtl,{ifDimIs:['ISS'],Tax:{ISS:0.06}});

				this.$.tablePercentualManual
					.put(ReceitaBrl,
						{ifDimIs:['PIS','Cofins'],Tax:{useMeta:true}
					});

				this.$.tablePercentualManual
					.put(ReceitaTtl,{ifDimIs:['ISS'],Tax:{useMeta:true}});

			},
			//sn-relatorios
			_getDataFromBaseHandler:function(e){
				var List = e.detail;
			}
		});
	</script>
</dom-module>