
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">

<dom-module id="sn-receita-bruta-novo-cliente">
	<template>
		<style>
			:host {
				display: block;
			}
			#dialog {
				width: 356px;
			}
			#dialog /deep/ label {
				color: inherit!important;
			}
			#dialog /deep/ .unfocused-line {
				background:  inherit!important;
			}
			#dialog /deep/ input {
				color: inherit!important;
			}
			#dialog /deep/ paper-input ,  
			#dialog /deep/ paper-dropdown-menu {
			  width: inherit!important;
			  margin-right: inherit!important;
			}
		</style>
		<paper-dialog id="dialog">
		  <h2>Novo Cliente</h2>
		  <paper-dialog-scrollable>
		    <paper-input label="Nome" value="{{ nomeCliente }}"></paper-input>

			 <paper-datatable data="{{faixasCliente}}" id="dataTable">

			 <paper-datatable-column 
				type="Number"
	            header="Faixa de" 
	            property="faixaA" 
	            align="right"></paper-datatable-column>
	         <paper-datatable-column 
				editable 
				dialog 
				type="Number"
	            header="Faixa atÃ©" 
	            property="faixaB" 
	            align="right"></paper-datatable-column>

	        <paper-datatable-column 
				editable 
				dialog 
				type="Number"
	            header="Tarifa R$" 
	            property="tarifa" 
	            align="right"></paper-datatable-column>

			 <paper-datatable>
		  </paper-dialog-scrollable>
		  <div class="buttons">
		    <paper-button dialog-dismiss>Cancelar</paper-button>
		    <paper-button dialog-confirm autofocus>OK</paper-button>
		  </div>
		</paper-dialog>
	</template>
	<script>
		Polymer({
			is: 'sn-receita-bruta-novo-cliente',
			properties:{
				faixasCliente:{type:Array,observer:'_clientObserver'}
			},
			listeners:{
				'change':'_clientObserver'
			},
			ready:function(){
				this.nomeCliente = "*";
				this.faixasCliente = [
						{faixa:10	,tarifa:25},
						{faixa:20 	,tarifa:35},
						{faixa:30 	,tarifa:45},
						{faixa:40 	,tarifa:55},
						{faixa:50 	,tarifa:65}
					]
			},
			open:function(){
				this.$.dialog.open();
			},
			_clientObserver:function(){
				console.log('_clientObserver')
				_.each(this.faixasCliente,function(faixaTuple,k){

					if(faixaTuple.faixaB)
						faixaTuple.faixa 	= faixaTuple.faixaB;;
					delete faixaTuple.faixaB;
					delete faixaTuple.faixaA;

				});
				_.each(this.faixasCliente,function(faixaTuple,k){

					var faixaA = k > 0 ? this.faixasCliente[k-1].faixa: 0;
					var faixaB = faixaTuple.faixa;
					

					faixaTuple.faixaA = faixaA;
					faixaTuple.faixaB = faixaB;

					if(faixaTuple.faixaB < faixaTuple.faixaA) {
						faixaTuple.faixa = faixaTuple.faixaB = faixaTuple.faixaA + 2;
					}

				}.bind(this))

				this.$.dataTable.ready();
			},
		});
	</script>
</dom-module>